<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tank War</title>
<style>
body{margin:0;background:#111;color:white;font-family:Verdana;overflow:hidden;}
button{padding:8px 15px;margin:5px;font-size:14px;cursor:pointer}
canvas{display:none;}

#menu,#gameOver,#market{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
text-align:center;
background:#222;
padding:30px;
border:2px solid white;
}

#gameOver,#market{display:none;}

#hud{
position:absolute;
top:10px;
left:20px;
font-size:22px;
font-weight:bold;
}

#healthContainer{
position:absolute;
top:10px;
right:20px;
width:200px;
height:25px;
background:#400;
border:2px solid white;
display:none;
}
#healthBar{height:100%;width:100%;background:red;}

#joystick{
position:absolute;
bottom:40px;
left:40px;
width:120px;
height:120px;
background:rgba(255,255,255,0.15);
border-radius:50%;
display:none;
}

#fireBtn{
position:absolute;
bottom:60px;
right:60px;
width:80px;
height:80px;
background:red;
border-radius:50%;
display:none;
}
</style>
</head>
<body>

<div id="menu">
<h1>Tank War</h1>
<button onclick="startGame()">BaÅŸla</button>
<button onclick="openMarket()">Market</button>
</div>

<div id="market">
<h2>Skin Market (50 Puan)</h2>
<p>Toplam Puan: <span id="money"></span></p>
<button onclick="buySkin('stripeRed')">KÄ±rmÄ±zÄ± Ã‡izgili</button>
<button onclick="buySkin('stripeBlack')">Siyah Mavi Ã‡izgili</button>
<button onclick="buySkin('random')">Rastgele</button>
<br><br>
<button onclick="closeMarket()">Geri</button>
</div>

<div id="gameOver">
<h2 id="overText"></h2>
<button onclick="startGame()">Tekrar</button>
<button onclick="backMenu()">MenÃ¼</button>
</div>

<div id="hud">ðŸŸ¡ Puan: 0</div>
<div id="healthContainer"><div id="healthBar"></div></div>

<div id="joystick"></div>
<div id="fireBtn"></div>

<canvas id="canvas"></canvas>

<script>
let canvas=document.getElementById("canvas");
let ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

/* CÄ°HAZ TESPÄ°TÄ° */
let isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

let gameActive=false;
let score=0;
let totalScore=parseInt(localStorage.getItem("tankScore"))||0;
let hp=100;
let difficulty=0;

let player=null;
let enemies=[],bullets=[],obstacles=[];
let keys={},camX=0,camY=0;
let mapW=3000,mapH=3000;

let ownedSkins=["default"];
let currentSkin="default";

/* ===== MENU ===== */
function backMenu(){
gameActive=false;
canvas.style.display="none";
healthContainer.style.display="none";
gameOver.style.display="none";
menu.style.display="block";
}

function openMarket(){
menu.style.display="none";
market.style.display="block";
money.innerText=totalScore;
}

function closeMarket(){
market.style.display="none";
menu.style.display="block";
}

function buySkin(type){
if(totalScore<50){alert("Yetersiz puan!");return;}
if(!ownedSkins.includes(type)){
totalScore-=50;
localStorage.setItem("tankScore",totalScore);
ownedSkins.push(type);
}
currentSkin=type;
money.innerText=totalScore;
}

/* ===== START ===== */
function startGame(){
menu.style.display="none";
gameOver.style.display="none";
canvas.style.display="block";
healthContainer.style.display="block";

if(isMobile){
joystick.style.display="block";
fireBtn.style.display="block";
}

gameActive=true;
score=0;
hp=100;
difficulty=0;

player={x:1500,y:1500,size:40,angle:0,speed:5};

enemies=[]; bullets=[]; obstacles=[];
for(let i=0;i<5;i++) spawnEnemy();
for(let i=0;i<25;i++) spawnObstacle();
}

function spawnEnemy(){
enemies.push({
x:Math.random()*mapW,
y:Math.random()*mapH,
hp:60,
speed:2.5
});
}

function spawnObstacle(){
obstacles.push({
x:Math.random()*mapW,
y:Math.random()*mapH,
w:100,
h:100
});
}

/* ===== PC MOUSE ATEÅž ===== */
canvas.addEventListener("click",function(e){
if(!gameActive || isMobile) return;

let rect=canvas.getBoundingClientRect();
let mx=e.clientX-rect.left+camX;
let my=e.clientY-rect.top+camY;

let angle=Math.atan2(my-player.y,mx-player.x);
player.angle=angle;

bullets.push({
x:player.x,
y:player.y,
dx:Math.cos(angle)*10,
dy:Math.sin(angle)*10
});
});

/* ===== MOBÄ°L ATEÅž ===== */
fireBtn.addEventListener("touchstart",function(){
if(!gameActive) return;
bullets.push({
x:player.x,
y:player.y,
dx:Math.cos(player.angle)*10,
dy:Math.sin(player.angle)*10
});
});

/* ===== JOYSTICK ===== */
joystick.addEventListener("touchmove",function(e){
if(!gameActive) return;
let touch=e.touches[0];
let dx=touch.clientX-100;
let dy=touch.clientY-(window.innerHeight-100);
player.x+=dx*0.02;
player.y+=dy*0.02;
});

/* ===== KEYBOARD ===== */
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

/* ===== UPDATE ===== */
function update(){
if(!gameActive||!player) return;

let nextX=player.x;
let nextY=player.y;

if(!isMobile){
if(keys["w"]) nextY-=player.speed;
if(keys["s"]) nextY+=player.speed;
if(keys["a"]) nextX-=player.speed;
if(keys["d"]) nextX+=player.speed;
}

if(nextX>20 && nextX<mapW-20) player.x=nextX;
if(nextY>20 && nextY<mapH-20) player.y=nextY;

/* obstacle collision */
obstacles.forEach(o=>{
if(player.x+20>o.x && player.x-20<o.x+o.w &&
   player.y+20>o.y && player.y-20<o.y+o.h){
player.x=nextX;
player.y=nextY;
}
});

camX=player.x-canvas.width/2;
camY=player.y-canvas.height/2;

/* bullets */
bullets.forEach((b,i)=>{
b.x+=b.dx;
b.y+=b.dy;

if(b.x<0||b.x>mapW||b.y<0||b.y>mapH)
bullets.splice(i,1);

enemies.forEach((e,ei)=>{
if(Math.hypot(b.x-e.x,b.y-e.y)<30){
e.hp-=30;
bullets.splice(i,1);
if(e.hp<=0){
enemies.splice(ei,1);
score++;
totalScore++;
localStorage.setItem("tankScore",totalScore);
spawnEnemy();
}
}
});
});

/* enemies */
enemies.forEach(e=>{
let ang=Math.atan2(player.y-e.y,player.x-e.x);
e.x+=Math.cos(ang)*e.speed;
e.y+=Math.sin(ang)*e.speed;

if(Math.hypot(player.x-e.x,player.y-e.y)<40){
hp-=0.4;
if(hp<=0){hp=0;endGame();}
}
});

hud.innerHTML="ðŸŸ¡ Puan: "+totalScore;
healthBar.style.width=hp+"%";
}

/* ===== DRAW ===== */
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
if(!player) return;

ctx.save();
ctx.translate(-camX,-camY);

ctx.fillStyle="#2e8b57";
ctx.fillRect(0,0,mapW,mapH);

ctx.fillStyle="#777";
obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));

ctx.save();
ctx.translate(player.x,player.y);
ctx.rotate(player.angle);

ctx.fillStyle="lime";
ctx.fillRect(-20,-20,40,40);
ctx.fillStyle="#111";
ctx.fillRect(0,-5,50,10);

ctx.restore();

ctx.fillStyle="red";
enemies.forEach(e=>ctx.fillRect(e.x-20,e.y-15,40,30));

ctx.fillStyle="yellow";
bullets.forEach(b=>{
ctx.beginPath();
ctx.arc(b.x,b.y,5,0,Math.PI*2);
ctx.fill();
});

ctx.restore();
}

function endGame(){
gameActive=false;
overText.innerText="Ã–ldÃ¼n! Toplam Puan: "+totalScore;
gameOver.style.display="block";
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
